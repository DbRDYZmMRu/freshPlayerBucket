name: Rename Album Cover Images in cover/1 to cover/15

on:
  workflow_dispatch:
    inputs:
      commit_message:
        description: 'Commit message for renaming album cover images'
        required: false
        default: 'Rename album cover images in cover/1 to cover/15 from <number>.<ext> to cover.<ext>'

jobs:
  rename_images:
    runs-on: ubuntu-latest
    permissions:
      contents: write

    steps:
      # Step 1: Checkout the Repository
      - name: Checkout Repository
        uses: actions/checkout@v4
        with:
          repository: ${{ github.repository }}
          ref: main

      # Step 2: Debug cover Folder Contents
      - name: List cover Folder Contents
        run: |
          echo "Listing contents of cover folder:"
          ls -laR cover || echo "cover folder is empty or does not exist."

      # Step 3: Rename Images in cover/1 to cover/15
      - name: Rename Images
        run: |
          echo "Processing cover/1 to cover/15..."
          for i in {1..15}; do
            folder="cover/$i"
            album_cover_folder="$folder/album_cover"
            if [ -d "$album_cover_folder" ]; then
              echo "Found album_cover folder in $folder"
              found=false
              for ext in jpg png jpeg; do
                image_file="$album_cover_folder/$i.$ext"
                if [ -f "$image_file" ]; then
                  new_name="$folder/cover.$ext"
                  echo "Renaming $image_file to $new_name"
                  mv "$image_file" "$new_name" || echo "Failed to rename $image_file to $new_name"
                  found=true
                  break
                fi
              done
              if [ "$found" = false ]; then
                echo "No image with name $i.{jpg,png,jpeg} found in $album_cover_folder"
              fi
            else
              echo "album_cover folder not found in $folder"
            fi
          done
          echo "Listing contents of cover after renaming:"
          ls -laR cover

      # Step 4: Configure Git User
      - name: Configure Git User
        run: |
          echo "Configuring Git user..."
          git config --global user.name 'github-actions[bot]'
          git config --global user.email 'github-actions[bot]@users.noreply.github.com'

      # Step 5: Commit and Push Changes
      - name: Commit and Push Changes
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          echo "Adding cover to git..."
          git add cover
          echo "Git status after add:"
          git status
          if git diff --cached --quiet; then
            echo "No changes to commit"
          else
            echo "Committing changes..."
            git commit -m "${{ github.event.inputs.commit_message || 'Rename album cover images in cover/1 to cover/15 from <number>.<ext> to cover.<ext>' }}"
            echo "Pushing changes..."
            git push origin main
          fi